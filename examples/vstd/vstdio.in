%ifnlabel _VSTDIO_IN
%labelv   _VSTDIO_IN

;; dump_str takes an output file from RA (0 for stdout, else stderr) and a const char* str from RB.as_ptr and dumps the str to the file
__dump_str_start:
    DUMPCHAR RC RA R0
    INC RB 1
    READ8 RC RB R0
    JMPF RC @__dump_str_start
    ;; restoring registers RC and RB
    POP RC
    POP RB
    RET
dump_str:
    ;; saving registers RB and RC
    PUSH RB
    PUSH RC
    
    READ8 RC RB R0
    JMPF RC @__dump_str_start
    ;; restoring registers RB and RC
    POP RC
    POP RB
    RET
%unlabel __dump_str_start


;; dump_uint takes the output file from RA.u8 (0 for stdout, else stderr) and an unsigned integer from RB.u64, it then dumps the unsigned integer to the provided file
dump_uint_print:
    loop:
        DIVU RE RB RC
        MUL  RE RE RC
	    SUB  RF RB RE
        DIVU RC RC RD
        DIVU RE RF RC
        MOVV RF '0'
        ADD  RF RF RE
        DUMPCHAR RF RA R0
        MOVV RF 1
        BIGU RF RC RF
    JMPF RF @loop
    POP RF
    POP RE
    POP RD
    POP RC
    RET
%unlabel loop
dump_uint:
    ; saving auxiliary registers
    PUSH RC
    PUSH RD
    PUSH RE
    PUSH RF

    MOVV RC 10
    MOVV RD 10
    loop:
        DIVI RE RB RC
        NOT  RE RE
        JMPF RE @dump_uint_print
        MUL  RC RC RD
    JMP @loop
%unlabel loop
%unlabel dump_uint_print


;; dump_int takes the output file from RA (0 for stdout, else stderr) and a signed integer from RB, it then prints the signed integer to the output file
dump_int_neg:
    MOVV RC '-'
    DUMPCHAR RC RA R0
    PUSH RB
    ABS  RB RB R0
    CALL @dump_uint
    POP RB
    POP RC
    RET
dump_int:
    PUSH RC
    
    SMLI RC RB R0
    JMPF RC @dump_int

    CALL @dump_uint
    POP RC
    RET
%unlabel dump_int_neg


%endif
