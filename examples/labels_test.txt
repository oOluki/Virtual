%label SUCCESS "LABELS TEST WAS SUCCESSFULL"

%enum ;; output

    INVALID = -1,

    STDOUT = 0

    STDERR = 1

    OUTPUT_COUNT,

%endenum

%labelv X

%label FAIL "[ERROR] TEST FAILED"

dummy:

%unlabel X      ;; testing the label addition and deletion

%iflabel X      ;; testing the if macros

%label HELLO $FAIL
%label OUTPUT $STDERR

%endif

%ifnlabel X

%label HELLO $SUCCESS
%label OUTPUT $STDOUT

%endif

%unlabel dummy

say_hello_false:
    .say_hello:
    STATIC $FAIL
    POP RB
    MOVV RE 1
    MOVV RD $STDERR
    
    READ8    RC RB R0
    .say_hello_loop:
        JMPFN    RC @.say_hello_loop_end
        DUMPCHAR RC RD R0
        ADD      RB RE RB
        READ8    RC RB R0
        JMP @.say_hello_loop
    .say_hello_loop_end:

    MOVV RC 10
    DUMPCHAR RC RD R0
    RET


say_hello:
    JMP @.say_hello
    JMP @say_hello_false
    .say_hello:

    STATIC $HELLO
    POP RB
    MOVV RE 1
    MOVV RD $OUTPUT
    
    READ8    RC RB R0
    .say_hello_loop:
        JMPFN    RC @.say_hello_loop_end
        DUMPCHAR RC RD R0
        ADD      RB RE RB
        READ8    RC RB R0
        JMP @.say_hello_loop
    .say_hello_loop_end:

    MOVV RC 10
    DUMPCHAR RC RD R0
    RET

;%unlabel say_hello_false

%start
    CALL @say_hello
    MOVV RA $OUTPUT
    MOVV RB $STDOUT
    NEQ  RA RA RB
    MOVN RB 255
    OR   RA RA RB
    HALT RA
